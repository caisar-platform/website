
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>4.2. (Local) Robustness of MNIST dataset &#8212; CAISAR 0.2 documentation</title>
    <link rel="stylesheet" type="text/css" href="static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="static/graphviz.css" />
    <script data-url_root="./" id="documentation_options" src="static/documentation_options.js"></script>
    <script src="static/jquery.js"></script>
    <script src="static/underscore.js"></script>
    <script src="static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="5. Index" href="genindex.html" />
    <link rel="prev" title="4.1. Functional properties of ACAS-Xu" href="acas_xu.html" />
   
  <link rel="stylesheet" href="static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="local-robustness-of-mnist-dataset">
<span id="mnist"></span><h1><span class="section-number">4.2. </span>(Local) Robustness of MNIST dataset<a class="headerlink" href="#local-robustness-of-mnist-dataset" title="Permalink to this headline">¶</a></h1>
<p>CAISAR provides a convenient way for verifying (local) robustness properties of
neural networks working on datasets with values in <span class="math notranslate nohighlight">\([0, 1]\)</span>, for
classification problems only. For the moment, CAISAR supports datasets in a
specific <code class="docutils literal notranslate"><span class="pre">CSV</span></code> format only, where each <code class="docutils literal notranslate"><span class="pre">CSV</span></code> lines is interpreted as
providing the classification label in the first column, and the dataset element
features in the remaining columns.</p>
<p>We recall that a neural network is deemed robust on a dataset element whenever
it classify with a same label all other elements being at an
<span class="math notranslate nohighlight">\(l_\infty\)</span>-distance of at most <span class="math notranslate nohighlight">\(\epsilon \geq 0\)</span> from it. More in
general, a neural network is deemed (locally) robust on a dataset whenever the
former property is valid on all the dataset elements. The CAISAR standard
library specifies such a property in terms of the predicate <code class="docutils literal notranslate"><span class="pre">robust</span></code>, which
CAISAR implements as a builtin.</p>
<p>In the following, we will describe how to use CAISAR for verifying a neural
network robust on (a fragment of) the MNIST dataset.</p>
<section id="use-case-presentation">
<h2><span class="section-number">4.2.1. </span>Use case presentation<a class="headerlink" href="#use-case-presentation" title="Permalink to this headline">¶</a></h2>
<p>MNIST is a dataset of handwritten digits normalized and centered to fit into
grayscale images of <span class="math notranslate nohighlight">\(28 \times 28\)</span> pixels, along with the classification
labels <a class="reference internal" href="#lideng2012" id="id1"><span>[LiDeng2012]</span></a>. Although it is mostly irrelevant as dataset for
benchmarking machine learning models for computer vision tasks, MNIST is still
valuable for assessing robustness properties by means of formal method tools.</p>
<p>CAISAR provides in <a class="reference external" href="https://git.frama-c.com/pub/caisar/-/blob/master/examples/mnist/csv/mnist_test.csv">mnist_test.csv</a>
a fragment (<span class="math notranslate nohighlight">\(100\)</span> images) of the MNIST dataset under the
<code class="docutils literal notranslate"><span class="pre">examples/mnist/csv</span></code> folder. Each line in this file represents an MNIST image:
in particular, the first column represents the classification label, and the
remaining <span class="math notranslate nohighlight">\(784\)</span> columns represent the greyscale value of the respective
pixels, rescaled into <span class="math notranslate nohighlight">\([0, 1]\)</span>.</p>
<section id="properties">
<h3><span class="section-number">4.2.1.1. </span>Properties<a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h3>
<p>Generally speaking, the property we are interested in verifying is the local
robustness of a machine learning model on the elements of a set. That is, the
model classifies all elements of a set being at an <span class="math notranslate nohighlight">\(l_\infty\)</span>-distance of
at most <span class="math notranslate nohighlight">\(\epsilon \geq 0\)</span> with a same label. A general formulation of this
latter states that, given a classifier <span class="math notranslate nohighlight">\(C\)</span>, a set <span class="math notranslate nohighlight">\(X\)</span>, and some
perturbation <span class="math notranslate nohighlight">\(\epsilon \geq 0\)</span>, it must hold that <span class="math notranslate nohighlight">\(\forall x,x'
\in X. \ \lVert x - x' \rVert_\infty \leq \epsilon \Rightarrow C(x) = C(x')\)</span>.</p>
<p>Since we actually deal with a <em>dataset</em> of finite elements for which we also
know the expected labels, we will instead verify a slightly different property:
given a classifier <span class="math notranslate nohighlight">\(C\)</span>, an element <span class="math notranslate nohighlight">\(x \in X\)</span> such that <span class="math notranslate nohighlight">\(C(x) =
y\)</span>, and some perturbation <span class="math notranslate nohighlight">\(\epsilon \geq 0\)</span>, it must hold that
<span class="math notranslate nohighlight">\(\forall x'. \ \lVert x - x' \rVert_\infty \leq \epsilon \Rightarrow C(x)
= y = C(x')\)</span>. Obviously, such a property must be verified for all elements of a
dataset.</p>
</section>
<section id="modelling-the-problem-using-whyml">
<h3><span class="section-number">4.2.1.2. </span>Modelling the problem using WhyML<a class="headerlink" href="#modelling-the-problem-using-whyml" title="Permalink to this headline">¶</a></h3>
<p>As described for the example on <a class="reference internal" href="acas_xu.html#acas-xu"><span class="std std-ref">Functional properties of ACAS-Xu</span></a>, we first need to write a
specification file containing a WhyML theory to describe the verification
problem. In principle, we need to formalize the local robustness property as
well as the notions of classifier and dataset.</p>
<p>The CAISAR standard library <a class="reference external" href="https://git.frama-c.com/pub/caisar/-/blob/master/stdlib/caisar.mlw">caisar.mlw</a> provides
some utilities for dealing with verification problems about classification
datasets. Of particular interest for us is the <code class="docutils literal notranslate"><span class="pre">robust</span></code> predicate, defined in
the theory <code class="docutils literal notranslate"><span class="pre">DatasetClassificationProps</span></code> as follows:</p>
<div class="highlight-whyml notranslate"><div class="highlight"><pre><span></span><span class="k">predicate</span> <span class="n">robust</span> <span class="p">(</span><span class="n">m</span><span class="p">:</span> <span class="n">model</span><span class="p">)</span> <span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="n">dataset</span><span class="p">)</span> <span class="p">(</span><span class="n">eps</span><span class="p">:</span> <span class="n">t</span><span class="p">)</span> <span class="o">=</span>
  <span class="k">forall</span> <span class="n">i</span><span class="p">:</span> <span class="n">int</span><span class="p">.</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">d</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">length</span> <span class="o">-&gt;</span> <span class="n">robust_at</span> <span class="n">m</span> <span class="n">d</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="n">eps</span>
</pre></div>
</div>
<p>Note that the predicate is defined over a <code class="docutils literal notranslate"><span class="pre">model</span></code>, a <code class="docutils literal notranslate"><span class="pre">dataset</span></code> and a
floating-point value <code class="docutils literal notranslate"><span class="pre">eps</span></code>. The latter determines the perturbation
<span class="math notranslate nohighlight">\(\epsilon\)</span>. The other two are custom WhyML types that respectively
formalize the notions of classifier and dataset in CAISAR. These types are
both defined in the <code class="docutils literal notranslate"><span class="pre">DatasetClassification</span></code> theory.</p>
<p>Moreover, it is defined in terms of the predicate <code class="docutils literal notranslate"><span class="pre">robust_at</span></code> that formalizes
the local robustness property:</p>
<div class="highlight-whyml notranslate"><div class="highlight"><pre><span></span><span class="k">predicate</span> <span class="n">robust_at</span> <span class="p">(</span><span class="n">m</span><span class="p">:</span> <span class="n">model</span><span class="p">)</span> <span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="n">record</span><span class="p">)</span> <span class="p">(</span><span class="n">eps</span><span class="p">:</span> <span class="n">t</span><span class="p">)</span> <span class="o">=</span>
  <span class="k">forall</span> <span class="n">x&#39;</span><span class="p">:</span> <span class="n">features</span><span class="p">.</span>
    <span class="k">let</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">d</span> <span class="k">in</span>
    <span class="n">linfty_distance</span> <span class="n">x</span> <span class="n">x&#39;</span> <span class="n">eps</span> <span class="o">-&gt;</span>
    <span class="n">predict</span> <span class="n">m</span> <span class="n">x</span> <span class="o">=</span> <span class="n">predict</span> <span class="n">m</span> <span class="n">x&#39;</span>
</pre></div>
</div>
<p>Note that a <code class="docutils literal notranslate"><span class="pre">record</span></code> is a dataset element given as a pair of <em>features</em> and
(classification) <em>label</em>. Morever, <code class="docutils literal notranslate"><span class="pre">linfty_distance</span></code> is a predicate that
describes how two arrays of floating-point values (<em>i.e.</em> <code class="docutils literal notranslate"><span class="pre">features</span></code>) are
considered close up-to a pertubation <code class="docutils literal notranslate"><span class="pre">eps</span></code>, while <code class="docutils literal notranslate"><span class="pre">predict</span></code> is a function
that formalizes the execution of a model on some features to obtain the
corresponding classification label.</p>
<p>In order to use the <code class="docutils literal notranslate"><span class="pre">robust</span></code> predicate in our WhyML specification, we need
values of types <code class="docutils literal notranslate"><span class="pre">model</span></code> and <code class="docutils literal notranslate"><span class="pre">dataset</span></code>. For the former, CAISAR makes
available the constant <code class="docutils literal notranslate"><span class="pre">model</span></code> upon interpreting the <code class="docutils literal notranslate"><span class="pre">AsArray</span></code> sub-theory
that is built by the extension of the Why3 standard library for recognizing
neural network ONNX and NNet formats. For the latter, the CAISAR standard
library provides the constant <code class="docutils literal notranslate"><span class="pre">dataset</span></code> in <code class="docutils literal notranslate"><span class="pre">DatasetClassification</span></code> that will
be interpreted as the actual dataset the user needs to provide via the
command-line interface when launching a CAISAR verification.</p>
<p>Assuming we have a neural network named <code class="docutils literal notranslate"><span class="pre">MNIST_256_2.onnx</span></code> for MNIST
classification, the final WhyML file for specifying its local robustness on a
dataset, with each element’s feature pertubed by <span class="math notranslate nohighlight">\(1 \%\)</span>, looks like this:</p>
<div class="highlight-whyml notranslate"><div class="highlight"><pre><span></span><span class="k">theory</span> <span class="n">MNIST</span>
  <span class="k">use</span> <span class="n">MNIST_256_2</span><span class="p">.</span><span class="n">AsArray</span>
  <span class="k">use</span> <span class="n">ieee_float</span><span class="p">.</span><span class="n">Float64</span>
  <span class="k">use</span> <span class="n">caisar</span><span class="p">.</span><span class="n">DatasetClassification</span>
  <span class="k">use</span> <span class="n">caisar</span><span class="p">.</span><span class="n">DatasetClassificationProps</span>

  <span class="k">goal</span> <span class="n">robustness</span><span class="p">:</span>
   <span class="n">robust</span> <span class="n">model</span> <span class="n">dataset</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">0100000000000000002081668171172168513294309377670288085937500000</span><span class="p">:</span><span class="n">t</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
<p>This file is available, as is, under the <code class="docutils literal notranslate"><span class="pre">/examples/mnist/</span></code> folder as
<a class="reference external" href="https://git.frama-c.com/pub/caisar/-/blob/master/examples/mnist/property.why">property.why</a>.
The corresponding neural network in ONNX format is available under the
<code class="docutils literal notranslate"><span class="pre">/examples/mnist/nets/</span></code> folder as <a class="reference external" href="https://git.frama-c.com/pub/caisar/-/blob/master/examples/mnist/nets/MNIST_256_2.onnx">MNIST_256_2.onnx</a>.</p>
</section>
<section id="verifying-the-property-with-caisar">
<h3><span class="section-number">4.2.1.3. </span>Verifying the property with CAISAR<a class="headerlink" href="#verifying-the-property-with-caisar" title="Permalink to this headline">¶</a></h3>
<p>Now we may verify whether the previous robustness specification holds on the
MNIST fragment <code class="docutils literal notranslate"><span class="pre">mnist_test.csv</span></code> by means of the nnenum prover. This can be
done via CAISAR as follows:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>caisar verify --prover nnenum -L examples/mnist/nets --format whyml --dataset<span class="o">=</span>examples/mnist/csv/mnist_test.csv examples/mnist/property.why
<span class="go">[caisar] Goal robustness: Invalid</span>
</pre></div>
</div>
<p>The result tells us that there exists at least one image in <code class="docutils literal notranslate"><span class="pre">mnist_test.csv</span></code>
for which nnenum is sure that the model <code class="docutils literal notranslate"><span class="pre">MNIST_256_2.onnx</span></code> is not robust with
respect to <span class="math notranslate nohighlight">\(1 \%\)</span> perturbation. At the moment, CAISAR is not able to tell
which are the images in the dataset that cause such result.</p>
<dl class="citation">
<dt class="label" id="lideng2012"><span class="brackets"><a class="fn-backref" href="#id1">LiDeng2012</a></span></dt>
<dd><p>Li Deng, <em>The MNIST Database of Handwritten Digit Images for
Machine Learning Research</em>, IEEE Signal Process. Mag., 2012, pp.
141-142, doi: 10.1109/MSP.2012.2211477</p>
</dd>
</dl>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">CAISAR</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="foreword.html">1. Foreword</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">3. Using CAISAR</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="examples.html">4. CAISAR by Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="acas_xu.html">4.1. Functional properties of ACAS-Xu</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.2. (Local) Robustness of MNIST dataset</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="genindex.html">5. Index</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="examples.html"><span class="section-number">4. </span>CAISAR by Examples</a><ul>
      <li>Previous: <a href="acas_xu.html" title="previous chapter"><span class="section-number">4.1. </span>Functional properties of ACAS-Xu</a></li>
      <li>Next: <a href="genindex.html" title="next chapter"><span class="section-number">5. </span>Index</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, The CAISAR Development Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="sources/mnist.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>